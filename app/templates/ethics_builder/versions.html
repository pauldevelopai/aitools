{% extends "base.html" %}

{% block title %}Version History - {{ policy.title }} - {{ product_name }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-0">

    <!-- Header -->
    <div class="mb-8">
        <a href="/ethics-builder" class="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block">&larr; Back to policies</a>
        <h1 class="text-2xl font-bold text-gray-900">{{ policy.title }} &mdash; Version History</h1>
    </div>

    <!-- Compare Form -->
    {% if versions | length > 1 %}
    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-6">
        <h3 class="text-sm font-semibold text-indigo-900 mb-2">Compare Versions</h3>
        <form method="GET" action="/ethics-builder/{{ policy.id }}/compare" class="flex items-end gap-4">
            <div>
                <label class="block text-xs text-indigo-700 mb-1">From</label>
                <select name="v1" class="rounded-md border-gray-300 text-sm">
                    {% for v in versions %}
                    <option value="{{ v.version_number }}" {% if loop.last %}selected{% endif %}>v{{ v.version_number }} ({{ v.status }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-xs text-indigo-700 mb-1">To</label>
                <select name="v2" class="rounded-md border-gray-300 text-sm">
                    {% for v in versions %}
                    <option value="{{ v.version_number }}" {% if loop.first %}selected{% endif %}>v{{ v.version_number }} ({{ v.status }})</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition">
                Compare
            </button>
        </form>
    </div>
    {% endif %}

    <!-- Version List -->
    <div class="space-y-3">
        {% for v in versions %}
        <div class="bg-white rounded-lg shadow p-5 border-l-4 {% if v.status == 'published' %}border-green-500{% elif v.status == 'draft' %}border-yellow-500{% else %}border-gray-300{% endif %}">
            <div class="flex items-center justify-between">
                <div>
                    <div class="flex items-center gap-3">
                        <span class="text-lg font-semibold text-gray-900">Version {{ v.version_number }}</span>
                        {% if v.status == 'published' %}
                        <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium bg-green-100 text-green-800 rounded-full">Published</span>
                        {% elif v.status == 'draft' %}
                        <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">Draft</span>
                        {% else %}
                        <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-600 rounded-full">Archived</span>
                        {% endif %}
                    </div>
                    <p class="text-sm text-gray-500 mt-1">
                        Created {{ v.created_at.strftime('%d %b %Y %H:%M') }}
                        {% if v.published_at %}
                            &middot; Published {{ v.published_at.strftime('%d %b %Y %H:%M') }}
                        {% endif %}
                    </p>
                    {% if v.change_notes %}
                    <p class="text-sm text-gray-600 mt-1 italic">{{ v.change_notes }}</p>
                    {% endif %}
                </div>
                <div class="flex gap-2">
                    <a href="/ethics-builder/{{ policy.id }}/versions/{{ v.version_number }}" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-gray-50 rounded-md hover:bg-gray-100 transition">
                        View
                    </a>
                    {% if v.status == 'draft' %}
                    <a href="/ethics-builder/{{ policy.id }}/edit" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-indigo-700 bg-indigo-50 rounded-md hover:bg-indigo-100 transition">
                        Edit
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

</div>
{% endblock %}
