{# Tool Playbook Component - Public View

Shows newsroom implementation guidance from the playbook (if published).

Usage:
{% include "components/tool_playbook.html" %}

Required context:
- playbook: ToolPlaybook object (or None)
- tool: the tool data dict
#}

{% if playbook and playbook.status == "published" %}
<div class="tool-playbook bg-white rounded-lg shadow p-6" id="implementation-guide">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900">Implementation Guide</h2>
        <span class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-700">
            {{ playbook.source_count }} sources
        </span>
    </div>
    <p class="text-sm text-gray-500 mb-6">
        Newsroom-specific guidance based on real documentation and case studies.
    </p>

    <!-- Navigation Tabs -->
    <div class="border-b border-gray-200 mb-6">
        <nav class="-mb-px flex gap-4" id="playbook-tabs">
            {% if playbook.best_use_cases %}
            <button onclick="showPlaybookTab('use-cases')"
                    class="playbook-tab pb-2 text-sm font-medium border-b-2 border-indigo-500 text-indigo-600"
                    data-tab="use-cases">
                Use Cases
            </button>
            {% endif %}
            {% if playbook.implementation_steps %}
            <button onclick="showPlaybookTab('implementation')"
                    class="playbook-tab pb-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700"
                    data-tab="implementation">
                Implementation
            </button>
            {% endif %}
            {% if playbook.common_mistakes %}
            <button onclick="showPlaybookTab('pitfalls')"
                    class="playbook-tab pb-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700"
                    data-tab="pitfalls">
                Common Pitfalls
            </button>
            {% endif %}
            {% if playbook.privacy_notes %}
            <button onclick="showPlaybookTab('privacy')"
                    class="playbook-tab pb-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700"
                    data-tab="privacy">
                Privacy & Sources
            </button>
            {% endif %}
            {% if playbook.pricing_summary or playbook.integration_notes %}
            <button onclick="showPlaybookTab('details')"
                    class="playbook-tab pb-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700"
                    data-tab="details">
                Details
            </button>
            {% endif %}
        </nav>
    </div>

    <!-- Tab Content -->
    <div id="playbook-content">
        {% if playbook.best_use_cases %}
        <div id="tab-use-cases" class="playbook-panel">
            <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                <span class="text-xl">üéØ</span> Best Use Cases for Newsrooms
            </h3>
            <div class="prose prose-sm max-w-none text-gray-700">
                {{ playbook.best_use_cases | safe }}
            </div>
        </div>
        {% endif %}

        {% if playbook.implementation_steps %}
        <div id="tab-implementation" class="playbook-panel hidden">
            <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                <span class="text-xl">üìã</span> Implementation Steps
            </h3>
            <div class="prose prose-sm max-w-none text-gray-700">
                {{ playbook.implementation_steps | safe }}
            </div>
        </div>
        {% endif %}

        {% if playbook.common_mistakes %}
        <div id="tab-pitfalls" class="playbook-panel hidden">
            <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                <span class="text-xl">‚ö†Ô∏è</span> Common Mistakes to Avoid
            </h3>
            <div class="prose prose-sm max-w-none text-gray-700">
                {{ playbook.common_mistakes | safe }}
            </div>
        </div>
        {% endif %}

        {% if playbook.privacy_notes %}
        <div id="tab-privacy" class="playbook-panel hidden">
            <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                <span class="text-xl">üîí</span> Privacy & Source Protection
            </h3>
            <div class="prose prose-sm max-w-none text-gray-700">
                {{ playbook.privacy_notes | safe }}
            </div>
        </div>
        {% endif %}

        {% if playbook.pricing_summary or playbook.integration_notes %}
        <div id="tab-details" class="playbook-panel hidden">
            {% if playbook.pricing_summary %}
            <div class="mb-6">
                <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <span class="text-xl">üí∞</span> Pricing for Newsrooms
                </h3>
                <div class="prose prose-sm max-w-none text-gray-700">
                    {{ playbook.pricing_summary | safe }}
                </div>
            </div>
            {% endif %}

            {% if playbook.integration_notes %}
            <div>
                <h3 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <span class="text-xl">üîó</span> Integrations
                </h3>
                <div class="prose prose-sm max-w-none text-gray-700">
                    {{ playbook.integration_notes | safe }}
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Key Features (if available) -->
    {% if playbook.key_features %}
    <div class="mt-6 pt-4 border-t border-gray-200">
        <h3 class="text-sm font-semibold text-gray-700 mb-3">Key Features for Newsrooms</h3>
        <div class="flex flex-wrap gap-2">
            {% for feature in playbook.key_features %}
            <span class="text-xs px-3 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100">
                {{ feature }}
            </span>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- What This Replaces/Improves -->
    {% if playbook.replaces_improves %}
    <div class="mt-6 pt-4 border-t border-gray-200">
        <h3 class="text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
            <span>üîÑ</span> What This Tool Replaces or Improves
        </h3>
        <p class="text-sm text-gray-600">{{ playbook.replaces_improves }}</p>
    </div>
    {% endif %}

    <!-- Last Updated -->
    <div class="mt-6 pt-4 border-t border-gray-200 flex items-center justify-between text-xs text-gray-400">
        <span>
            Last updated: {{ playbook.updated_at.strftime('%B %d, %Y') if playbook.updated_at else 'Recently' }}
        </span>
        <span>
            Based on {{ playbook.source_count }} verified sources
        </span>
    </div>
</div>

<script>
function showPlaybookTab(tabId) {
    // Hide all panels
    document.querySelectorAll('.playbook-panel').forEach(panel => {
        panel.classList.add('hidden');
    });

    // Show selected panel
    const targetPanel = document.getElementById('tab-' + tabId);
    if (targetPanel) {
        targetPanel.classList.remove('hidden');
    }

    // Update tab styles
    document.querySelectorAll('.playbook-tab').forEach(tab => {
        if (tab.dataset.tab === tabId) {
            tab.classList.remove('border-transparent', 'text-gray-500');
            tab.classList.add('border-indigo-500', 'text-indigo-600');
        } else {
            tab.classList.remove('border-indigo-500', 'text-indigo-600');
            tab.classList.add('border-transparent', 'text-gray-500');
        }
    });
}
</script>

{% else %}
{# No published playbook - show placeholder #}
<div class="tool-playbook-empty bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6 text-center">
    <div class="text-4xl mb-3">üìñ</div>
    <h3 class="font-semibold text-gray-700 mb-2">Implementation Guide Coming Soon</h3>
    <p class="text-sm text-gray-500 max-w-md mx-auto">
        We're working on a detailed newsroom playbook for {{ tool.name }}.
        Check back soon for implementation steps, best practices, and privacy guidance.
    </p>
</div>
{% endif %}
