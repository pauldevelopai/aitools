{# Personalized Guidance Component for Tool Detail Page

Usage:
{% include "components/personalized_guidance.html" with context %}

Required context:
- tool_guidance: ToolGuidanceResponse object with fit_score, explanation, guidance, citations
- tool: the tool data dict

Optional:
- show_guidance: boolean (defaults to checking if tool_guidance exists)
#}

{% if tool_guidance %}
<div class="personalized-guidance bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border-2 border-purple-200 p-6" id="personalized-guidance">
    <div class="flex items-start justify-between mb-4">
        <div>
            <h2 class="text-lg font-semibold text-purple-900">For Your Context</h2>
            <p class="text-sm text-purple-700">Personalized guidance based on your profile and experience</p>
        </div>
        <div class="flex items-center gap-2">
            <span class="text-2xl font-bold
                {% if tool_guidance.fit_score >= 80 %}text-green-600
                {% elif tool_guidance.fit_score >= 60 %}text-yellow-600
                {% else %}text-gray-600{% endif %}">
                {{ tool_guidance.fit_score | round(0) }}%
            </span>
            <span class="text-xs text-purple-600">fit</span>
        </div>
    </div>

    {# Explanation #}
    <div class="mb-6">
        <h3 class="text-sm font-semibold text-gray-700 mb-2">Why This Tool Fits You</h3>
        <p class="text-gray-600">{{ tool_guidance.explanation }}</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {# Training Plan #}
        {% if tool_guidance.guidance.training_plan %}
        <div class="bg-white rounded-lg p-4 shadow-sm">
            <div class="flex items-center gap-2 mb-3">
                <span class="text-lg">ðŸ“š</span>
                <h3 class="font-semibold text-gray-900">Training Plan</h3>
                <span class="text-xs px-2 py-0.5 rounded-full
                    {% if tool_guidance.guidance.training_plan.intensity == 'fast-track' %}bg-green-100 text-green-700
                    {% elif tool_guidance.guidance.training_plan.intensity == 'extended' %}bg-orange-100 text-orange-700
                    {% else %}bg-blue-100 text-blue-700{% endif %}">
                    {{ tool_guidance.guidance.training_plan.intensity }}
                </span>
            </div>
            <div class="text-sm text-gray-600 mb-3">
                <span class="font-medium">Duration:</span> {{ tool_guidance.guidance.training_plan.duration }}
            </div>
            <ol class="text-sm space-y-2">
                {% for step in tool_guidance.guidance.training_plan.steps %}
                <li class="flex items-start gap-2">
                    <span class="flex-shrink-0 w-5 h-5 rounded-full bg-purple-100 text-purple-700 text-xs flex items-center justify-center font-medium">
                        {{ loop.index }}
                    </span>
                    <span class="text-gray-700">{{ step }}</span>
                </li>
                {% endfor %}
            </ol>
            {% if tool_guidance.guidance.training_plan.tips %}
            <div class="mt-4 pt-3 border-t border-gray-100">
                <div class="text-xs font-medium text-gray-500 uppercase mb-2">Tips</div>
                <ul class="text-xs text-gray-600 space-y-1">
                    {% for tip in tool_guidance.guidance.training_plan.tips %}
                    <li class="flex items-start gap-1">
                        <span class="text-purple-400">â€¢</span>
                        {{ tip }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
        {% endif %}

        {# Rollout Approach #}
        {% if tool_guidance.guidance.rollout_approach %}
        <div class="bg-white rounded-lg p-4 shadow-sm">
            <div class="flex items-center gap-2 mb-3">
                <span class="text-lg">ðŸš€</span>
                <h3 class="font-semibold text-gray-900">Rollout Approach</h3>
                <span class="text-xs px-2 py-0.5 rounded-full
                    {% if tool_guidance.guidance.rollout_approach.pace == 'fast-track' %}bg-green-100 text-green-700
                    {% elif tool_guidance.guidance.rollout_approach.pace == 'cautious' %}bg-orange-100 text-orange-700
                    {% else %}bg-blue-100 text-blue-700{% endif %}">
                    {{ tool_guidance.guidance.rollout_approach.pace }}
                </span>
            </div>

            {# Phases #}
            <div class="space-y-3 mb-4">
                {% for phase in tool_guidance.guidance.rollout_approach.phases %}
                <div class="border-l-2 border-purple-300 pl-3">
                    <div class="flex items-center gap-2">
                        <span class="font-medium text-sm text-gray-900">{{ phase.name }}</span>
                        <span class="text-xs text-gray-500">({{ phase.duration }})</span>
                    </div>
                    <p class="text-xs text-gray-600">{{ phase.description }}</p>
                </div>
                {% endfor %}
            </div>

            {# Gates #}
            {% if tool_guidance.guidance.rollout_approach.gates %}
            <div class="pt-3 border-t border-gray-100">
                <div class="text-xs font-medium text-gray-500 uppercase mb-2">Required Gates</div>
                <ul class="text-xs text-gray-600 space-y-1">
                    {% for gate in tool_guidance.guidance.rollout_approach.gates %}
                    <li class="flex items-start gap-1">
                        <span class="text-orange-500">âš¡</span>
                        {{ gate }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    {# Workflow Tips #}
    {% if tool_guidance.guidance.workflow_tips %}
    <div class="mt-4 bg-white rounded-lg p-4 shadow-sm">
        <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
            <span>ðŸ’¡</span> Workflow Integration
        </h3>
        <ul class="text-sm text-gray-600 space-y-2">
            {% for tip in tool_guidance.guidance.workflow_tips %}
            <li>{{ tip }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {# Citations #}
    {% if tool_guidance.citations %}
    <div class="mt-4 pt-4 border-t border-purple-200">
        <details class="text-sm">
            <summary class="cursor-pointer text-purple-700 font-medium">
                View Sources ({{ tool_guidance.citations | length }})
            </summary>
            <div class="mt-2 space-y-2">
                {% for citation in tool_guidance.citations %}
                <div class="bg-white rounded p-2 text-xs">
                    <span class="px-1.5 py-0.5 rounded text-white text-xs
                        {% if citation.type == 'cdi_data' %}bg-blue-500
                        {% elif citation.type == 'playbook' %}bg-purple-500
                        {% elif citation.type == 'review' %}bg-yellow-500
                        {% else %}bg-gray-500{% endif %}">
                        {{ citation.type }}
                    </span>
                    {% if citation.source %}
                    <span class="text-gray-500 ml-1">{{ citation.source }}</span>
                    {% endif %}
                    <p class="text-gray-600 mt-1">{{ citation.text }}</p>
                    {% if citation.rating %}
                    <span class="text-yellow-500">
                        {% for i in range(citation.rating) %}&#9733;{% endfor %}
                    </span>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </details>
    </div>
    {% endif %}

    {# Scoring Explanation #}
    <div class="mt-4 pt-4 border-t border-purple-200">
        <details class="text-sm">
            <summary class="cursor-pointer text-purple-700 font-medium flex items-center gap-2">
                <span>ðŸŽ¯</span> Why This Score?
            </summary>
            <div class="mt-3 bg-white rounded-lg p-4">
                <p class="text-gray-600 text-xs mb-3">
                    Your {{ tool_guidance.fit_score | round(0) }}% fit score is calculated based on how well this tool matches your profile:
                </p>
                <div class="grid grid-cols-2 gap-2 text-xs">
                    <div class="flex items-center gap-2">
                        <span class="text-blue-600 font-bold">30%</span>
                        <span class="text-gray-600">CDI Constraints</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-purple-600 font-bold">25%</span>
                        <span class="text-gray-600">Use Case Match</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-yellow-600 font-bold">20%</span>
                        <span class="text-gray-600">Reviews Signal</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-green-600 font-bold">15%</span>
                        <span class="text-gray-600">Your Activity</span>
                    </div>
                    <div class="flex items-center gap-2 col-span-2">
                        <span class="text-gray-500 font-bold">10%</span>
                        <span class="text-gray-600">Profile Fit (org type, country)</span>
                    </div>
                </div>
                <p class="text-xs text-gray-500 mt-3">
                    <a href="/profile" class="text-purple-600 underline">Update your profile</a>
                    to refine these recommendations.
                </p>
            </div>
        </details>
    </div>
</div>
{% endif %}
