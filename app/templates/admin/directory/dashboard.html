{% extends "admin/base.html" %}

{% block title %}Directory Dashboard{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Directory</h1>
            <p class="text-gray-600">Manage journalists, media organizations, and AI training engagements</p>
        </div>
        <div class="flex space-x-3">
            <a href="/admin/directory/sync" class="px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 text-sm font-medium flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                GROUNDED Sync
            </a>
            <a href="/admin/directory/insights" class="px-4 py-2 bg-amber-500 text-white rounded-md hover:bg-amber-600 text-sm font-medium flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>
                AI Insights
            </a>
            <a href="/admin/directory/search" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 text-sm font-medium">
                Search
            </a>
        </div>
    </div>

    <!-- Quick Add Section -->
    <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-lg shadow-sm border border-emerald-200 p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Quick Add</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Quick Add Journalist -->
            <form method="POST" action="/admin/directory/journalists" class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-medium text-gray-900 mb-3 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                    </svg>
                    Add Journalist
                </h3>
                <div class="grid grid-cols-2 gap-3">
                    <input type="text" name="first_name" required placeholder="First name *" class="border border-gray-300 rounded px-3 py-2 text-sm">
                    <input type="text" name="last_name" required placeholder="Last name *" class="border border-gray-300 rounded px-3 py-2 text-sm">
                    <input type="email" name="email" placeholder="Email" class="border border-gray-300 rounded px-3 py-2 text-sm">
                    <select name="organization_id" class="border border-gray-300 rounded px-3 py-2 text-sm">
                        <option value="">Organization (optional)</option>
                        {% for org in organizations %}
                        <option value="{{ org.id }}">{{ org.name }}</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="role" placeholder="Role/Title" class="border border-gray-300 rounded px-3 py-2 text-sm">
                    <select name="ai_skill_level" class="border border-gray-300 rounded px-3 py-2 text-sm">
                        <option value="none">AI Skill: None</option>
                        <option value="beginner">AI Skill: Beginner</option>
                        <option value="intermediate">AI Skill: Intermediate</option>
                        <option value="advanced">AI Skill: Advanced</option>
                    </select>
                </div>
                <input type="hidden" name="areas_of_interest" value="[]">
                <div class="mt-3 flex justify-between items-center">
                    <a href="/admin/directory/journalists/new" class="text-sm text-blue-600 hover:underline">Full form &rarr;</a>
                    <button type="submit" class="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 text-sm font-medium">
                        Add Journalist
                    </button>
                </div>
            </form>

            <!-- Quick Add Organization -->
            <form method="POST" action="/admin/directory/organizations" class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-medium text-gray-900 mb-3 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                    Add Organization
                </h3>
                <div class="grid grid-cols-2 gap-3">
                    <input type="text" name="name" required placeholder="Organization name *" class="col-span-2 border border-gray-300 rounded px-3 py-2 text-sm">
                    <select name="org_type" required class="border border-gray-300 rounded px-3 py-2 text-sm">
                        <option value="">Type *</option>
                        <option value="newspaper">Newspaper</option>
                        <option value="broadcaster">Broadcaster</option>
                        <option value="digital">Digital</option>
                        <option value="agency">News Agency</option>
                        <option value="magazine">Magazine</option>
                        <option value="freelance_collective">Freelance Collective</option>
                    </select>
                    <input type="text" name="country" placeholder="Country" class="border border-gray-300 rounded px-3 py-2 text-sm">
                    <input type="url" name="website" placeholder="Website URL" class="col-span-2 border border-gray-300 rounded px-3 py-2 text-sm">
                </div>
                <div class="mt-3 flex justify-between items-center">
                    <a href="/admin/directory/organizations/new" class="text-sm text-blue-600 hover:underline">Full form &rarr;</a>
                    <button type="submit" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm font-medium">
                        Add Organization
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <a href="/admin/directory/organizations" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:border-blue-300 transition">
            <div class="text-sm font-medium text-gray-500">Organizations</div>
            <div class="text-3xl font-bold text-gray-900 mt-1">{{ stats.organizations }}</div>
        </a>
        <a href="/admin/directory/journalists" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:border-blue-300 transition">
            <div class="text-sm font-medium text-gray-500">Journalists</div>
            <div class="text-3xl font-bold text-gray-900 mt-1">{{ stats.journalists }}</div>
        </a>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <div class="text-sm font-medium text-gray-500">Total Engagements</div>
            <div class="text-3xl font-bold text-gray-900 mt-1">{{ stats.engagements }}</div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <div class="text-sm font-medium text-gray-500">This Month</div>
            <div class="text-3xl font-bold text-blue-600 mt-1">{{ stats.this_month }}</div>
        </div>
    </div>

    <!-- Skill Distribution -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">AI Skill Level Distribution</h2>
        <div class="grid grid-cols-4 gap-4">
            <a href="/admin/directory/journalists?skill_level=none" class="text-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                <div class="text-2xl font-bold text-gray-600">{{ skill_stats.get('none', 0) }}</div>
                <div class="text-sm text-gray-500">None</div>
            </a>
            <a href="/admin/directory/journalists?skill_level=beginner" class="text-center p-4 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition">
                <div class="text-2xl font-bold text-yellow-600">{{ skill_stats.get('beginner', 0) }}</div>
                <div class="text-sm text-gray-500">Beginner</div>
            </a>
            <a href="/admin/directory/journalists?skill_level=intermediate" class="text-center p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition">
                <div class="text-2xl font-bold text-blue-600">{{ skill_stats.get('intermediate', 0) }}</div>
                <div class="text-sm text-gray-500">Intermediate</div>
            </a>
            <a href="/admin/directory/journalists?skill_level=advanced" class="text-center p-4 bg-green-50 rounded-lg hover:bg-green-100 transition">
                <div class="text-2xl font-bold text-green-600">{{ skill_stats.get('advanced', 0) }}</div>
                <div class="text-sm text-gray-500">Advanced</div>
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Recent Engagements -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">Recent Engagements</h2>
            </div>
            <div class="divide-y divide-gray-100">
                {% for engagement in recent_engagements %}
                <a href="/admin/directory/engagements/{{ engagement.id }}" class="block px-6 py-4 hover:bg-gray-50">
                    <div class="flex items-start justify-between">
                        <div>
                            <div class="font-medium text-gray-900">{{ engagement.title }}</div>
                            <div class="text-sm text-gray-500">
                                {{ engagement.journalist.full_name }} - {{ engagement.engagement_type|title }}
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">{{ engagement.date.strftime('%b %d') }}</div>
                    </div>
                </a>
                {% else %}
                <div class="px-6 py-8 text-center text-gray-500">
                    No engagements yet
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Upcoming Follow-ups -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">Upcoming Follow-ups</h2>
            </div>
            <div class="divide-y divide-gray-100">
                {% for engagement in upcoming_followups %}
                <a href="/admin/directory/journalists/{{ engagement.journalist_id }}" class="block px-6 py-4 hover:bg-gray-50">
                    <div class="flex items-start justify-between">
                        <div>
                            <div class="font-medium text-gray-900">{{ engagement.journalist.full_name }}</div>
                            <div class="text-sm text-gray-500">{{ engagement.follow_up_actions[:80] }}{% if engagement.follow_up_actions|length > 80 %}...{% endif %}</div>
                        </div>
                        <div class="text-sm font-medium text-orange-600">{{ engagement.follow_up_date.strftime('%b %d') }}</div>
                    </div>
                </a>
                {% else %}
                <div class="px-6 py-8 text-center text-gray-500">
                    No upcoming follow-ups
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Quick Links</h2>
        <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
            <a href="/admin/directory/organizations" class="p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition text-center">
                <div class="text-blue-600 font-medium">Organizations</div>
                <div class="text-sm text-gray-500">View all orgs</div>
            </a>
            <a href="/admin/directory/journalists" class="p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition text-center">
                <div class="text-blue-600 font-medium">Journalists</div>
                <div class="text-sm text-gray-500">View all contacts</div>
            </a>
            <a href="/admin/directory/journalists?skill_level=beginner" class="p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition text-center">
                <div class="text-blue-600 font-medium">Beginners</div>
                <div class="text-sm text-gray-500">Filter by skill</div>
            </a>
            <a href="/admin/directory/search" class="p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition text-center">
                <div class="text-blue-600 font-medium">Search</div>
                <div class="text-sm text-gray-500">Find anything</div>
            </a>
            <a href="/admin/directory/insights" class="p-4 border border-amber-200 rounded-lg hover:border-amber-400 hover:bg-amber-50 transition text-center">
                <div class="text-amber-600 font-medium">AI Insights</div>
                <div class="text-sm text-gray-500">Analyze data</div>
            </a>
            <a href="/admin/directory/sync" class="p-4 border border-indigo-200 rounded-lg hover:border-indigo-400 hover:bg-indigo-50 transition text-center">
                <div class="text-indigo-600 font-medium">GROUNDED Sync</div>
                <div class="text-sm text-gray-500">Sync to KB</div>
            </a>
        </div>
    </div>
</div>
{% endblock %}
